<!DOCTYPE html>
<html>
<head>
    <title>Temperature sensor</title>
</head>
<body>
    <h1>–î–∞—Ç—á–∏–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã</h1>
    <text>
        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞—á–µ–π –¥–∞–Ω–Ω—ã—Ö:<br>
        start ‚Äî —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å<br>
        stop ‚Äî —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
    </text>

    <form action="" onsubmit="sendMessage(event)">
        <input type="text" id="messageText" autocomplete="off"/>
        <button>Send</button>
    </form>

    <ul id='messages'>
    </ul>

    <script>
        var ws = new WebSocket("ws://localhost:8000/ws/client");
        var messages = document.getElementById('messages');
        var requestCounter = 0;

        ws.onmessage = function(event) {
            var data;
            try {
                data = JSON.parse(event.data);
            } catch (e) {
                addMessage("‚ö†Ô∏è " + event.data);
                return;
            }

            var message = document.createElement('li');

            // JSON-RPC –æ—Ç–≤–µ—Ç
            if (data.result !== undefined) {
                if (data.result === "Start command sent") {
                    message.textContent = "‚Üí Start command sent";
                } else if (data.result === "Stop command sent") {
                    message.textContent = "‚Üí Stop command sent";
                } 
                // –ü–æ–∫–∞–∑–∞–Ω–∏—è –¥–∞—Ç—á–∏–∫–∞
                else if (typeof data.result === "object" && data.result.time && data.result.value) {
                    message.textContent = "[" + data.result.time + "] Value: " + data.result.value;
                } else {
                    message.textContent = "‚Üí " + data.result;
                }
            }
            // –û—à–∏–±–∫–∞
            else if (data.error) {
                message.textContent = "‚ùå Error: " + data.error.message;
            }
            // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
            else {
                message.textContent = "üì¶ " + event.data;
            }

            messages.appendChild(message);
            messages.scrollTop = messages.scrollHeight;
        };

        function sendMessage(event) {
            var input = document.getElementById("messageText");
            var method = input.value.trim();

            if (!method) return;

            // –°–æ–∑–¥–∞—ë–º JSON-RPC –∑–∞–ø—Ä–æ—Å
            var request = {
                jsonrpc: "2.0",
                method: method,
                id: ++requestCounter
            };

            ws.send(JSON.stringify(request));
            addMessage("–í—ã: " + method);
            input.value = '';
            event.preventDefault();
        }

        function addMessage(text) {
            var message = document.createElement('li');
            message.textContent = text;
            messages.appendChild(message);
        }
    </script>
</body>
</html>